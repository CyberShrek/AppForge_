{"version":3,"file":"MainForm-29c5d669.js","sources":["../../../../../../../typescript/utils/DOMWizard.ts","../../../../../../../typescript/fragments/abstract/InputFragment.ts","../../../../../../../typescript/fragments/inputs/Button.ts","../../../../../../../typescript/utils/misc.ts","../../../../../../../typescript/fragments/inputs/DateInput.ts","../../../../../../../typescript/fragments/mainForm/fields/Field.ts","../../../../../../../typescript/fragments/mainForm/fields/DateField.ts","../../../../../../../typescript/fragments/inputs/Checkbox.ts","../../../../../../../typescript/fragments/mainForm/fields/CheckboxField.ts","../../../../../../../typescript/fragments/inputs/Select.ts","../../../../../../../typescript/utils/api/options/endpointOptions.ts","../../../../../../../typescript/fragments/mainForm/fields/select/SelectField.ts","../../../../../../../typescript/fragments/mainForm/fields/select/BankField.ts","../../../../../../../typescript/utils/api/options/serviceBank.ts","../../../../../../../typescript/fragments/mainForm/fields/select/CarriersField.ts","../../../../../../../typescript/fragments/mainForm/fields/select/CountriesField.ts","../../../../../../../typescript/fragments/mainForm/fields/select/RoadsField.ts","../../../../../../../typescript/fragments/mainForm/fields/select/StationsField.ts","../../../../../../../typescript/fragments/mainForm/MainForm.ts","../../../../../../../typescript/utils/api/validation.ts"],"sourcesContent":["// Returns created element with specific tag name and attributes\nexport function createElement<T extends HTMLElement>(tagName: string, textContent: string = \"\", ...attributes: Attribute[]): T{\n    const element = document.createElement(tagName) as T\n    if(textContent) element.textContent = textContent\n    attributes?.forEach(attribute =>\n        element.setAttribute(\n            Object.keys(attribute)[0],\n            String(Object.values(attribute)[0])\n        )\n    )\n    return element\n}\n\nexport function createDivElement(...attributes: Attribute[]): HTMLDivElement{\n    return createElement(\"div\", \"\", ...attributes)\n}\n\nexport function createButtonElement(textContent: string = \"\", ...attributes: Attribute[]): HTMLButtonElement{\n    return createElement(\"button\", textContent, ...attributes)\n}\n\nexport function createInputElement(type: string, ...attributes: Attribute[]): HTMLInputElement{\n    return createElement(\"input\", \"\", {type}, ...attributes)\n}\n\nexport function createLabelElement(textContent: string = \"\", ...attributes: Attribute[]): HTMLLabelElement{\n    return createElement(\"label\", textContent, ...attributes)\n}\n\nexport function createImageElement(src: string = \"\", alt: string = \"not found\", ...attributes: Attribute[]): HTMLImageElement{\n    return createElement(\"img\", \"\", {src}, ...attributes)\n}\n\n// Removes all child elements\nexport function emptyElement(element: Element){\n    while(element.firstElementChild !== null)\n        element.firstElementChild.remove()\n}\n\n// Returns startName with serial number\nexport function generateUniqueId(startName: string = \"element\"){\n    let serialNumber = -1,\n        name: string\n\n    do name = startName +\"-\"+ serialNumber++\n    while (document.getElementById(name) !== null)\n\n    return name\n}","import {Fragment} from \"./Fragment\"\n\nexport abstract class InputFragment<V> extends Fragment{\n\n    private _value: V\n    private valueEventCallbacks: ((value?: V) => void)[] = []\n    get value(): V {\n        return this._value\n    }\n    protected set value(value: V){\n        this._value = value\n        this.valueEventCallbacks.forEach(callback => callback(value))\n    }\n\n    protected constructor(protected readonly location: FragmentLocation) { super(location) }\n\n    subscribe(onValueEvent: (value: V) => void, doNotRunOnInit: boolean = false){\n        this.valueEventCallbacks.push(onValueEvent)\n        if(!doNotRunOnInit)\n            onValueEvent(this.value)\n    }\n\n    protected debounce(callback: () => void, delay: number = 100): () => void {\n        let timeoutId: NodeJS.Timeout;\n        return () => {\n            clearTimeout(timeoutId)\n            timeoutId = setTimeout(callback, delay)\n        }\n    }\n}","import {createButtonElement, createImageElement} from \"../../utils/DOMWizard\"\nimport {InputFragment} from \"../abstract/InputFragment\"\n\nexport class Button extends InputFragment<void> {\n\n    private imageElement: HTMLImageElement\n\n    constructor(location: FragmentLocation) {\n        super(location)\n        this.core = createButtonElement()\n        this.core.addEventListener(\"click\", () => {\n            if(this.isAvailable)\n                this.value = this.value\n        })\n    }\n\n    set isAvailable(available: boolean){\n        if(available)\n            this.core.classList.remove(\"unavailable\")\n        else this.core.classList.add(\"unavailable\")\n    }\n\n    get isAvailable(): boolean{\n        return !this.core.classList.contains(\"unavailable\")\n    }\n\n    set text(text: string){\n        this.core.textContent = text\n    }\n    get text(): string{\n        return this.core.textContent\n    }\n\n    set image(src: string|null){\n        this.imageElement.remove()\n        if(!!src) {\n            this.imageElement = createImageElement(src)\n            this.core.appendChild(this.imageElement)\n        }\n    }\n    get image(): string{\n        return this.imageElement?.src\n    }\n}","// Returns vararg items as a Set of the vararg items\nexport function setOf<T>(...items: T[]): Set<T>{\n    return new Set(items)\n}\n\n// Returns a Map of the vararg Pair entries\nexport function mapOf<K, V>(...entries: Pair<K, V>[]): Map<K, V>{\n    return new Map(entries.map(entry => [entry.first, entry.second]))\n}\n\n// Returns two arguments as a Pair object\nexport function pairOf<F, S>(first: F, second: S): Pair<F, S>{\n    return {first, second}\n}\n\n// Returns a basic number from gotten string if this is possible, or 0 if not\nexport function numberOf(word: string|number): number {\n    return isNaN(Number(word)) ? 0 : Number(word)\n}\n\n// Returns a Map consisting of the vararg Maps\nexport function concatMaps(...maps: Map<any, any>[]): Map<any, any>{\n    const buffer = []\n    maps.forEach(map => buffer.push(...map.entries()))\n    return new Map(buffer)\n}\n\n// Returns sorted by key Map\nexport function sortMap<K, V>(contentMap: Map<K, V>): Map<K, V>{\n    return new Map([...contentMap.entries()].sort(\n        (a : [K, V], b : [K, V]) : number => a[0] > b[0] ? 1 : a[0] < b[0] ? -1 : 0\n    ))\n}\n\nexport function filterMap<K, V>(map: Map<K, V>, filter: (value: V, key: K) => boolean): Map<K, V> {\n    return new Map(Array.from(map).filter(([key, value]) => filter(value, key)))\n}\n\nexport function stringify<T>(value: T): string{\n    if(value === null || value === undefined)\n        return \"\"\n    if(typeof value !== \"object\")\n        return String(value)\n    if(value instanceof Set)\n        return Array.from(value).join(\", \")\n    if (value instanceof Date)\n        return stringifyDate(value)\n\n    return value.toString()\n}\n\nexport function stringifyDate(date: Date): string {\n    const year = date.getFullYear(),\n        month = date.getMonth() + 1,\n        day = date.getDate()\n    return `${year}-${month < 10 ? '0' : ''}${month}-${day < 10 ? '0' : ''}${day}`\n}\n\nexport function javaSetToSet(javaSet: string): Set<string>{\n    return setOf(...splitJavaCollection(javaSet))\n}\n\nexport function javaMapToMap(javaMap: string): Map<string, string>{\n    return mapOf(\n        ...splitJavaCollection(javaMap)\n        .map(pair => {\n            const entry = pair.split(\"=\")\n            return pairOf(entry[0], entry[1])\n        })\n    )\n}\n\nexport function splitJavaCollection(javaCollection: string): string[]{\n    return javaCollection\n        .slice(1, -1) // Removing '{' and '}' in the both sides of the string\n        .split(\", \")\n}\n\nexport function setCursorToLoading() {\n    document.documentElement.style.cursor = 'wait'\n}\n\nexport function setCursorToDefault() {\n    document.documentElement.style.cursor = 'default'\n}","import {resolveCSS} from \"../../utils/resolver\"\nimport {numberOf, stringifyDate} from \"../../utils/misc\"\nimport {easepick} from \"@easepick/core\"\nimport {AmpPlugin} from \"@easepick/amp-plugin\"\nimport {RangePlugin} from \"@easepick/range-plugin\"\nimport {LockPlugin} from \"@easepick/lock-plugin\"\nimport {DateTime} from \"@easepick/datetime\"\nimport {InputFragment} from \"../abstract/InputFragment\"\nimport {createDivElement} from \"../../utils/DOMWizard\"\n\nresolveCSS(\"third-party/easepick\")\n\nexport default class DateInput extends InputFragment<DateRange>{\n\n    constructor(location: FragmentLocation, config: DateInputConfig) {\n        super(location)\n        this.core = createDivElement({class: \"datepicker\"})\n        if(!config.defaultRange)\n            config.defaultRange = [stringifyDate(new Date()), stringifyDate(new Date())]\n\n        this.value = config.defaultRange\n        applyPicker(this.core, config, dateRange => {\n            this.value = dateRange\n        })\n    }\n}\n\nfunction applyPicker(core: HTMLElement, config: DateInputConfig, onSelect: (dateRange: DateRange) => void){\n    new easepick.create({\n        element: core,\n        format: \"DD.MM.YYYY\",\n        calendars: 2,\n        grid: 2,\n        zIndex: 100,\n        plugins: [AmpPlugin, RangePlugin, LockPlugin],\n        lang: 'ru',\n        AmpPlugin: {\n            darkMode: false,\n            resetButton: true,\n            dropdown: {\n                minYear: 2010, maxYear: null, months: true, years: true\n            }\n        },\n        RangePlugin: {\n            startDate: new DateTime(config.defaultRange[0]),\n            endDate: new DateTime(config.defaultRange[1]),\n            locale: {\n                one: 'день',\n                few: 'дня',\n                many: 'дней'\n            },\n            delimiter: \" - \"\n        },\n        LockPlugin: {\n            minDays: 1,\n            maxDays: config.maxDays\n        },\n        css: [\n            \"css/third-party/easepick.css\"\n        ],\n        setup(picker) {\n            picker.on(\"select\", (e) => {\n                onSelect([stringifyDate(e.detail.start), stringifyDate(e.detail.end)])\n                setTimeout(() => picker.hide(), 10)\n            })\n        }\n    })\n}","import {InputFragment} from \"../../abstract/InputFragment\"\nimport {Fragment} from \"../../abstract/Fragment\"\nimport {createLabelElement} from \"../../../utils/DOMWizard\";\n\nexport abstract class Field<T extends InputFragment<any>> extends Fragment{\n\n    readonly input: T\n\n    private readonly warningLabel: HTMLLabelElement\n\n    protected constructor(location: FragmentLocation,\n                          InputClass: new(location: FragmentLocation, config: InputConfig) => T,\n                          inputConfig: InputConfig\n    ) {\n        super(location)\n        this.core = location.target\n        this.input = new InputClass({target: location.target, position: \"afterbegin\"}, inputConfig)\n        this.warningLabel = createLabelElement()\n        this.core.appendChild(this.warningLabel)\n    }\n\n    makeValid(){\n        this.warningLabel.textContent = \"\"\n        this.core.classList.remove(\"wrong\")\n    }\n\n    makeInvalid(message?: string){\n        this.warningLabel.textContent = message\n        this.core.classList.add(\"wrong\")\n    }\n}","import DateInput from \"../../inputs/DateInput\"\nimport {numberOf} from \"../../../utils/misc\"\nimport {Field} from \"./Field\";\n\nexport class DateField extends Field<DateInput>{\n\n    constructor(location: FragmentLocation, configElement: HTMLElement) {\n        super(location, DateInput, {\n            maxDays: numberOf(configElement.getAttribute(\"max-days\"))\n        })\n    }\n}","import {InputFragment} from \"../abstract/InputFragment\"\nimport {createDivElement, createInputElement, createLabelElement, generateUniqueId} from \"../../utils/DOMWizard\"\n\nexport default class Checkbox extends InputFragment<boolean>{\n\n    private checkBoxElement = createInputElement(\"checkbox\", {id: generateUniqueId(\"checkbox\")})\n    private labelElement    = createLabelElement(\"\", {for: this.checkBoxElement.id})\n\n    constructor(location: FragmentLocation, config: CheckboxInputConfig) {\n        super(location)\n        this.core = createDivElement({class: \"checkbox\"})\n        this.core.append(this.checkBoxElement, this.labelElement)\n        this.label = config.label\n        const updateValue=() => this.value = this.checkBoxElement.checked\n        updateValue()\n        this.checkBoxElement.addEventListener(\"change\", updateValue)\n    }\n\n    set label(name: string){\n        this.labelElement.textContent = name\n    }\n}","import Checkbox from \"../../inputs/Checkbox\"\nimport {Field} from \"./Field\";\n\nexport class CheckboxField extends Field<Checkbox>{\n    constructor(location: FragmentLocation, configElement: HTMLElement) {\n        super(location, Checkbox, {\n            label: configElement.getAttribute(\"label\")\n        })\n    }\n}","import {resolveCSS} from \"../../utils/resolver\"\nimport {InputFragment} from \"../abstract/InputFragment\"\nimport {createDivElement} from \"../../utils/DOMWizard\"\nimport {stringify} from \"../../utils/misc\"\n\nresolveCSS(\"third-party/virtual-select\")\n\n// When multiselect turned on then value is OptionKey else value is Set<OptionKey>\nexport default class Select extends InputFragment<OptionKey|Set<OptionKey>>{\n\n    constructor(location: FragmentLocation, config: SelectInputConfig) {\n        super(location)\n        this.core = createDivElement({class: \"select\"})\n        this.value = null\n        // this.value = config.multiple === true ? new Set() : \"\"\n        applyVirtualSelect(this.core, config)\n        this.core.addEventListener(\"change\", event => {\n            const newValue: OptionKey|Set<OptionKey> = config.multiple === true\n                // @ts-ignore !!! Resolved by html import !!!\n                ? new Set(typeof event.currentTarget.value === \"object\" ? event.currentTarget.value : [event.currentTarget.value])\n                // @ts-ignore !!! Resolved by html import !!!\n                : event.currentTarget.value\n            // Need to check real changes to prevent doubling\n            if(stringify(this.value) !== stringify(newValue))\n                this.value = newValue\n        })\n    }\n\n    protected optionsRetrievalCallbacks: Set<() => Promise<Options>> = new Set()\n\n    setOptions(options: Options){\n        const enabledOptionsCache: Set<OptionKey> = this.value === null ? new Set() : this.value instanceof Set ? this.value : new Set([this.value])\n        if(!!options && options.size > 0) {\n            const defaultOptions: Set<OptionKey> = new Set(options.get(\"default\")?.split(\",\"))\n            options.delete(\"default\")\n            // @ts-ignore !!! Resolved by html import !!!\n            this.core.setOptions(mapToVirtualSelectOptions(options))\n            this.setSelected(enabledOptionsCache.size > 0 ? enabledOptionsCache : defaultOptions)\n            // @ts-ignore !!! Resolved by html import !!!\n            this.core.enable()\n        }\n        else {\n            // @ts-ignore !!! Resolved by html import !!!\n            this.core.disable()\n            // @ts-ignore !!! Resolved by html import !!!\n            this.core.reset()\n            this.core.blur()\n        }\n    }\n\n    setSelected(values: Set<OptionKey> = new Set()){\n        // @ts-ignore !!! Resolved by html import !!!\n        this.core.setValue(Array.from(values))\n    }\n}\n\nfunction applyVirtualSelect(core: HTMLElement, config: SelectInputConfig){\n    // @ts-ignore !!! Resolved by html import !!!\n    VirtualSelect.init({\n        ele: core,\n        additionalClasses: \"multiselect\",\n        disabled: true,\n        autofocus: false,\n        markSearchResults: true,\n        optionsCount: 6,\n        multiple: config.multiple,\n        search: config.search,\n        hasOptionDescription: config.showCodes,\n        disableSelectAll: config.disableSelectAll,\n        maxValues: config.maxValues,\n\n        placeholder: \"Выберите\",\n        noOptionsText: \"Варианты не найдены\",\n        noSearchResultsText: \"Результатов не найдено\",\n        selectAllText: \"Выбрать все\",\n        searchPlaceholderText: \"Поиск...\",\n        optionsSelectedText: \"(выбрано)\",\n        optionSelectedText: \"вариант выбран\",\n        allOptionsSelectedText: \"Все\",\n        clearButtonText: \"Очистить\",\n        moreText: \"ещё...\"\n    })\n}\n\nfunction mapToVirtualSelectOptions(map: Map<string, string>): any[]{\n    return [...map.entries()].map(entry => {\n        return {\n            label: entry[1],\n            value: entry[0],\n            alias: entry[0],\n            description: entry[0]\n        }\n    })\n}","import wretch from \"wretch\"\nimport {popupHttpDataError} from \"../../modal\"\nimport {setCursorToDefault, setCursorToLoading} from \"../../misc\"\n\nexport const fetchEndpointOptions = (url: string, headers?: Map<string, string>): Promise<Options> => {\n        setCursorToLoading()\n        return wretch(url)\n            .headers(headers ? Object.fromEntries(headers) : {})\n            .get()\n            .json(json => new Map<OptionKey, OptionLabel>(Object.entries(json)))\n            .catch(error => {\n                popupHttpDataError(error, \"Не удалось загрузить список опций\")\n                return new Map()\n            })\n            .finally(() => setCursorToDefault())\n}","import Select from \"../../../inputs/Select\"\nimport {concatMaps, javaSetToSet, numberOf, stringify} from \"../../../../utils/misc\"\nimport {InputFragment} from \"../../../abstract/InputFragment\"\nimport {fetchEndpointOptions} from \"../../../../utils/api/options/endpointOptions\"\nimport {Field} from \"../Field\";\n\nexport class SelectField extends Field<Select>{\n    constructor(location: FragmentLocation,\n                protected configElement: HTMLElement) {\n        const getBoolAttr=(attributeName: string): boolean => configElement.getAttribute(attributeName) === \"true\"\n        super(location, Select, {\n            maxValues: numberOf(configElement.getAttribute(\"max-values\")),\n            multiple: getBoolAttr(\"multiselect\"),\n            search: getBoolAttr(\"search\"),\n            showCodes: getBoolAttr(\"show-codes\"),\n            disableSelectAll: getBoolAttr(\"disable-select-all\")\n        } as SelectInputConfig)\n    }\n\n    optionsRetrieving = false\n\n    private endpointConfigElement: HTMLElement = this.configElement.querySelector(\"endpoint\")\n    private endpointUrl: string = this.endpointConfigElement?.querySelector(\"url\")?.textContent\n    private endpointSubscribedFields: Map<string, Field<InputFragment<any>>|null> = new Map(this.endpointConfigElement ?\n        [...this.endpointConfigElement.querySelectorAll<HTMLElement>(\"subscriptions field\")]\n            .map(fieldElement => [fieldElement.textContent, null]) : null)\n\n    resolveSubscribedFields(getFieldFn: (key: string) => Field<InputFragment<any>>){\n        this.endpointSubscribedFields.forEach((_, key) => {\n            this.endpointSubscribedFields.set(key, getFieldFn(key))\n        })\n    }\n\n    listenSubscribedFields(){\n        if(!!this.endpointUrl) {\n            if (this.endpointSubscribedFields.size > 0) {\n                const headers: Map<string, string> = new Map()\n                this.endpointSubscribedFields.forEach(<T>(field: Field<InputFragment<any>>, key) =>\n                    field.input.subscribe(value => {\n                        headers.set(key, value != null ? stringify(value) : null)\n                        if (this.optionsRetrieving === true)\n                            this.retrieveOptionsPromise(\n                                \"endpoint\", fetchEndpointOptions(this.endpointUrl, headers))\n                    }))\n            } else this.retrieveOptionsPromise(\"endpoint\", fetchEndpointOptions(this.endpointUrl))\n        }\n    }\n\n    private optionsBuffer: Map<string, Options> = new Map()\n    protected retrieveOptionsPromise(optionsGroupName: string, promise: Promise<Options>){\n        promise.then(options => {\n            this.optionsBuffer.set(optionsGroupName, options)\n            this.input.setOptions(concatMaps(...this.optionsBuffer.values()))\n        })\n    }\n}","import {SelectField} from \"./SelectField\"\nimport {DateField} from \"../DateField\"\nimport {InputFragment} from \"../../../abstract/InputFragment\"\nimport {stringify} from \"../../../../utils/misc\";\nimport {Field} from \"../Field\";\n\nexport abstract class BankField extends SelectField{\n    protected constructor(location: FragmentLocation, configElement: HTMLElement) {\n        super(location, configElement)\n    }\n\n    protected bankConfigElement: HTMLElement = this.configElement.querySelector(\"bank\")\n\n    private dateFieldKey = this.bankConfigElement.querySelector(\"subscriptions date\")?.textContent\n    protected dateFieldSubscription: DateField = null\n\n    override resolveSubscribedFields(getFieldFn: (key: string) => Field<InputFragment<any>>) {\n        super.resolveSubscribedFields(getFieldFn)\n        this.dateFieldSubscription = getFieldFn(this.dateFieldKey)\n    }\n\n    protected resolveBankSubscribing(fetchOptionsFn: (...subscriptionValues: any[]) => Promise<Options>,\n                                     ...subscriptionFields: Field<InputFragment<any>>[]){\n\n        subscriptionFields.forEach(field =>\n            field.input.subscribe(value => {\n                for (const subscription of subscriptionFields) {\n                    if (subscription.input.value === null || stringify(subscription.input.value).length <= 0) {\n                        this.input.setOptions(null)\n                        return\n                    }\n                }\n                this.retrieveOptionsPromise(\"bank\",\n                    fetchOptionsFn(...subscriptionFields.map(subscription => subscription.input.value)))\n            }))\n    }\n}","// This code exports four functions that can be used to fetch carriers, countries, roads, and stations from a service bank API.\n// The code also defines several interfaces for different types of objects.\nimport wretch from \"wretch\"\nimport {popupHttpDataError} from \"../../modal\";\nimport {setCursorToDefault, setCursorToLoading} from \"../../misc\";\nconst serviceBankURL = `${document.location.origin}/servicebank/getdata`\n\nexport const fetchCarriersByDate = (date: DateRange): Promise<Map<OptionKey, OptionLabel>> =>\n    fetchOptions(\"perList\", date,\n        (item) => [\n        // Each key consists of countryKey.carrierKey\n        `${item[\"gos\"]}.${item[\"skp\"]}`,\n        item[\"nazvp\"]\n        ],\n        null,null,\n        \"Не удалось загрузить список перевозчиков\")\n\nexport const fetchCountriesByDate = (date: DateRange, postSovietOnly: boolean): Promise<Options> =>\n    fetchOptions(\"gosList\", date,\n        (item) => [item[\"g_kod\"], item[\"g_name\"]],\n        {\"g_prsng\": \"1\"},\n        (item) => postSovietOnly ? item[\"g_prsng\"] == \"1\" : true,\n        \"Не удалось загрузить список государств\")\n\nexport const fetchRoadsByDateAndCountries = async (date: DateRange,\n                                                   countryKeys: OptionKey|Set<OptionKey>): Promise<Options> => {\n    const fetchRoads=(countryKey) =>\n        fetchOptions(\"dorList\", date,\n            item => [\n                // Each key consists of countryKey.roadKey\n                `${countryKey}.${item[\"d_kod\"]}`,\n                item[\"d_name\"]\n            ],\n            {\n                \"gos\": countryKey\n            }, null,\n            \"Не удалось загрузить список дорог\"\n        )\n    if (countryKeys instanceof Set)\n        return mergePromises([...countryKeys].map(countryKey => fetchRoads(countryKey)))\n\n    return fetchRoads(countryKeys)\n}\n\n\nexport const fetchStationsByDateAndRoads = async (date: DateRange,\n                                                  roadKeys: OptionKey|Set<OptionKey>,\n                                                  extraProperty?: Pair<string, string>): Promise<Options> =>\n    mergePromises(\n        [...mapRoadsByCountryCodeAndRoadCodes(roadKeys)].map(([countryValue, roadValues]) =>\n            fetchOptions(\"stanList\", date,\n                (item) => [item[\"stan\"], item[\"pnazv\"]],\n                {\n                    \"gos\": countryValue,\n                    \"dor\": roadValues.join(\",\"),\n                    // [extraProperty.first]: extraProperty.second,\n                    // [transferType === TransferType.BAGGAGE ? \"pr_bo\" : \"prpop\"]: \"1\"\n                    \"pr_bo\": \"1\"\n                }, null,\n                \"Не удалось загрузить список станций\")\n        )\n    )\n\n\nconst fetchOptions = (listName: string,\n                      date: DateRange,\n                      parseItemFn: (item: any) => [OptionKey, OptionLabel],\n                      extraProperties = {},\n                      filter?: (item: any) => boolean,\n                      errorFooter?: string): Promise<Options> => {\n    setCursorToLoading()\n    return wretch(serviceBankURL)\n        .post({\n            [listName]: [{\"data\": date[0], ...extraProperties}]\n        })\n        .json(json => {\n            const firstChildKey = Object.keys(json)[0]\n            return new Map((json[firstChildKey] as Array<any>)\n                .filter((item) => filter ? filter(item) : true)\n                .map((item) => parseItemFn(item)))\n        })\n        .catch(error => {\n            popupHttpDataError(error, errorFooter)\n            return new Map()\n        })\n        .finally(() => setCursorToDefault())\n}\n\nfunction mergePromises(promises: Promise<Map<OptionKey, OptionLabel>>[]): Promise<Options> {\n    return Promise.all(promises)\n        .then((results) => {\n            const mergedResult = new Map<OptionKey, OptionLabel>();\n            results.forEach((result) => {\n                result.forEach((value, key) => {\n                    mergedResult.set(key, value);\n                });\n            });\n            return mergedResult;\n        })\n        .catch((error) => {\n            // Обработка ошибок\n        }) as Promise<Options>\n}\n\n\nfunction mapRoadsByCountryCodeAndRoadCodes (roads: OptionKey|Set<OptionKey>) {\n    const codesMap = new Map<OptionKey, string[]>()\n    const parseRoad = (road: OptionKey) => {\n        const roadValueEntries = road.split(\".\"),\n            countryValue = roadValueEntries[0],\n            roadValue = roadValueEntries[1]\n\n        if (!codesMap.has(countryValue)) {\n            codesMap.set(countryValue, [])\n        }\n        codesMap.get(countryValue)?.push(roadValue)\n    }\n    if(roads instanceof Set)\n        roads.forEach(road => parseRoad(road))\n    else parseRoad(roads)\n\n    return codesMap\n}","import {BankField} from \"./BankField\"\nimport {fetchCarriersByDate} from \"../../../../utils/api/options/serviceBank\"\nimport {createLabelElement} from \"../../../../utils/DOMWizard\";\n\nexport class CarriersField extends BankField{\n    constructor(location: FragmentLocation, configElement: HTMLElement) {\n        super(location,configElement)\n    }\n\n    override listenSubscribedFields() {\n        super.listenSubscribedFields()\n        this.resolveBankSubscribing(fetchCarriersByDate, this.dateFieldSubscription)\n    }\n}","import {BankField} from \"./BankField\"\nimport {fetchCountriesByDate} from \"../../../../utils/api/options/serviceBank\"\nimport {InputFragment} from \"../../../abstract/InputFragment\"\nimport {Field} from \"../Field\";\nimport {createLabelElement} from \"../../../../utils/DOMWizard\";\n\nexport class CountriesField extends BankField {\n\n    constructor(location: FragmentLocation, configElement: HTMLElement) {\n        super(location,configElement)\n    }\n\n    private postSovietKey = this.bankConfigElement.querySelector(\"subscriptions postsoviet\")?.textContent\n    private postSovietSubscription\n\n    override resolveSubscribedFields(getFieldFn: (key: string) => Field<InputFragment<any>>) {\n        super.resolveSubscribedFields(getFieldFn)\n        this.postSovietSubscription = getFieldFn(this.postSovietKey)\n    }\n\n    override listenSubscribedFields() {\n        super.listenSubscribedFields()\n        this.resolveBankSubscribing(fetchCountriesByDate, this.dateFieldSubscription, this.postSovietSubscription)\n    }\n}","import {BankField} from \"./BankField\"\nimport {InputFragment} from \"../../../abstract/InputFragment\"\nimport {fetchRoadsByDateAndCountries} from \"../../../../utils/api/options/serviceBank\"\nimport {Field} from \"../Field\"\n\nexport class RoadsField extends BankField {\n\n    constructor(location: FragmentLocation, configElement: HTMLElement) {\n        super(location,configElement)\n    }\n\n    private countriesKey = this.bankConfigElement.querySelector(\"subscriptions countries\")?.textContent\n    private countriesSubscription\n\n    override resolveSubscribedFields(getFieldFn: (key: string) => Field<InputFragment<any>>) {\n        super.resolveSubscribedFields(getFieldFn)\n        this.countriesSubscription = getFieldFn(this.countriesKey)\n    }\n\n    override listenSubscribedFields() {\n        super.listenSubscribedFields()\n        this.resolveBankSubscribing(fetchRoadsByDateAndCountries, this.dateFieldSubscription, this.countriesSubscription)\n    }\n}","import {BankField} from \"./BankField\"\nimport {InputFragment} from \"../../../abstract/InputFragment\"\nimport {fetchStationsByDateAndRoads} from \"../../../../utils/api/options/serviceBank\"\nimport {Field} from \"../Field\";\nimport {createLabelElement} from \"../../../../utils/DOMWizard\";\n\nexport class StationsField extends BankField {\n\n    constructor(location: FragmentLocation, configElement: HTMLElement) {\n        super(location,configElement)\n    }\n\n    private roadsKey = this.bankConfigElement.querySelector(\"subscriptions roads\")?.textContent\n    private roadsSubscription\n\n    override resolveSubscribedFields(getFieldFn: (key: string) => Field<InputFragment<any>>) {\n        super.resolveSubscribedFields(getFieldFn)\n        this.roadsSubscription = getFieldFn(this.roadsKey)\n    }\n\n    override listenSubscribedFields() {\n        super.listenSubscribedFields()\n        this.resolveBankSubscribing(fetchStationsByDateAndRoads, this.dateFieldSubscription, this.roadsSubscription)\n    }\n}","import {resolveCSS} from \"../../utils/resolver\"\nimport {Button} from \"../inputs/Button\"\nimport {InputFragment} from \"../abstract/InputFragment\"\nimport {Text} from \"../inputs/Text\"\nimport {DateField} from \"./fields/DateField\"\nimport {CheckboxField} from \"./fields/CheckboxField\"\nimport {SelectField} from \"./fields/select/SelectField\"\nimport {CarriersField} from \"./fields/select/CarriersField\"\nimport {CountriesField} from \"./fields/select/CountriesField\"\nimport {RoadsField} from \"./fields/select/RoadsField\"\nimport {StationsField} from \"./fields/select/StationsField\"\nimport {validateFieldValues} from \"../../utils/api/validation\";\nimport {stringify} from \"../../utils/misc\";\nimport {Field} from \"./fields/Field\";\n\nresolveCSS(\"main-form\")\n\nexport default class MainForm extends InputFragment<MainFormValues>{\n\n    readonly confirmButton: Button\n\n    private readonly validationUrl: string\n\n    constructor(location: FragmentLocation) {\n        super(location)\n        this.core = location.target\n        this.value = new Map()\n        this.confirmButton = new Button({target: this.core, position: \"afterend\"})\n        this.confirmButton.addClass(\"confirm\")\n        this.confirmButton.text = this.core.getAttribute(\"confirm-button-text\")\n        console.log(this.confirmButton)\n        this.validationUrl = this.core.getAttribute(\"validation-url\")\n        this.resolveFields()\n        this.resolveFieldsSubscriptions()\n    }\n\n    private fields: Map<string, Field<InputFragment<any>>> = new Map()\n\n    private resolveFields(){\n        this.core.querySelectorAll(\".section\").forEach(sectionElement => {\n            const sectionKey = sectionElement.getAttribute(\"key\")\n            sectionElement.querySelectorAll(\".field\").forEach(fieldElement => {\n                const fieldKey = fieldElement.getAttribute(\"key\")\n                this.fields.set(`${sectionKey}.${fieldKey}`, resolveField(fieldElement as HTMLElement))\n            })\n        })\n    }\n\n    private resolveFieldsSubscriptions(){\n        this.fields.forEach((field, key) => {\n            if(field instanceof SelectField) {\n                field.resolveSubscribedFields(key => this.fields.get(key))\n                field.listenSubscribedFields()\n                field.optionsRetrieving = true\n            }\n            field.input.subscribe(value => {\n                this.value.set(key, value)\n                this.validateFields()\n            })\n        })\n    }\n\n    private validateFields(){\n        this.confirmButton.isAvailable = false\n        if(!!this.validationUrl){\n            this.fields.forEach(field => field.makeValid())\n            validateFieldValues(this.validationUrl, this.value).then(result => {\n                if(result instanceof Map)\n                    result.forEach((message, fieldKey) => this.fields.get(fieldKey).makeInvalid(message))\n                else if(result === true)\n                    this.confirmButton.isAvailable = true\n            })\n        }\n    }\n}\n\nfunction resolveField(fieldElement: HTMLElement): Field<InputFragment<any>>{\n    const containsClass = (className: string) => fieldElement.classList.contains(className)\n    const location: FragmentLocation = {target: fieldElement}\n    const configElement: HTMLElement = fieldElement.querySelector(\"config\")\n    return containsClass(\"date\") ? new DateField(location, configElement)\n        : containsClass(\"checkbox\") ? new CheckboxField(location, configElement)\n            : resolveSelectField(location, configElement)\n}\n\nfunction resolveSelectField(location: FragmentLocation, configElement: HTMLElement): SelectField{\n    switch (configElement.querySelector(\"bank\")?.getAttribute(\"type\")){\n        case \"carriers\":  return new CarriersField(location, configElement)\n        case \"countries\": return new CountriesField(location, configElement)\n        case \"roads\":     return new RoadsField(location, configElement)\n        case \"stations\":  return new StationsField(location, configElement)\n    }\n    return new SelectField(location, configElement)\n}","import wretch from \"wretch\"\nimport {setCursorToDefault, setCursorToLoading} from \"../misc\"\nimport {popupHttpDataError} from \"../modal\"\n\nexport function validateFieldValues(url: string, fieldValues: MainFormValues): Promise<boolean|Map<OptionKey, string>>{\n    setCursorToLoading()\n    return wretch(url)\n        .json(Object.fromEntries(fieldValues))\n        .post()\n        .forbidden(error => new Map(Object.entries(error.json)))\n        .text(() => true)\n        .catch(error => {\n            popupHttpDataError(error, \"Ошибка валидации\")\n            return false\n        })\n        .finally(() => setCursorToDefault())\n}"],"names":["createElement","tagName","textContent","attributes","element","document","forEach","attribute","setAttribute","Object","keys","String","values","createDivElement","createLabelElement","generateUniqueId","startName","name","serialNumber","getElementById","InputFragment","Fragment","value","this","_value","valueEventCallbacks","callback","constructor","location","super","subscribe","onValueEvent","doNotRunOnInit","push","debounce","delay","timeoutId","clearTimeout","setTimeout","Button","core","createButtonElement","addEventListener","isAvailable","available","classList","remove","add","contains","text","image","src","imageElement","alt","createImageElement","appendChild","_a","numberOf","word","isNaN","Number","stringify","Set","Array","from","join","Date","stringifyDate","toString","date","year","getFullYear","month","getMonth","day","getDate","setCursorToLoading","documentElement","style","cursor","setCursorToDefault","resolveCSS","DateInput","config","class","defaultRange","onSelect","easepick","create","format","calendars","grid","zIndex","plugins","AmpPlugin","RangePlugin","LockPlugin","lang","darkMode","resetButton","dropdown","minYear","maxYear","months","years","startDate","DateTime","endDate","locale","one","few","many","delimiter","minDays","maxDays","css","setup","picker","on","e","detail","start","end","hide","applyPicker","dateRange","Field","InputClass","inputConfig","target","input","position","warningLabel","makeValid","makeInvalid","message","DateField","configElement","getAttribute","Checkbox","checkBoxElement","type","createInputElement","id","labelElement","for","append","label","updateValue","checked","CheckboxField","Select","optionsRetrievalCallbacks","VirtualSelect","init","ele","additionalClasses","disabled","autofocus","markSearchResults","optionsCount","multiple","search","hasOptionDescription","showCodes","disableSelectAll","maxValues","placeholder","noOptionsText","noSearchResultsText","selectAllText","searchPlaceholderText","optionsSelectedText","optionSelectedText","allOptionsSelectedText","clearButtonText","moreText","applyVirtualSelect","event","newValue","currentTarget","setOptions","options","enabledOptionsCache","size","defaultOptions","get","split","delete","entries","map","entry","alias","description","setSelected","enable","disable","reset","blur","setValue","fetchEndpointOptions","url","headers","wretch","fromEntries","json","Map","catch","error","popupHttpDataError","finally","SelectField","getBoolAttr","attributeName","optionsRetrieving","endpointConfigElement","querySelector","endpointUrl","_b","endpointSubscribedFields","querySelectorAll","fieldElement","optionsBuffer","resolveSubscribedFields","getFieldFn","_","key","set","listenSubscribedFields","field","retrieveOptionsPromise","optionsGroupName","promise","then","maps","buffer","concatMaps","BankField","bankConfigElement","dateFieldKey","dateFieldSubscription","resolveBankSubscribing","fetchOptionsFn","subscriptionFields","subscription","length","serviceBankURL","origin","fetchCarriersByDate","fetchOptions","item","fetchCountriesByDate","postSovietOnly","g_prsng","fetchRoadsByDateAndCountries","async","countryKeys","fetchRoads","countryKey","gos","mergePromises","fetchStationsByDateAndRoads","roadKeys","extraProperty","mapRoadsByCountryCodeAndRoadCodes","countryValue","roadValues","dor","pr_bo","listName","parseItemFn","extraProperties","filter","errorFooter","post","assign","data","firstChildKey","promises","Promise","all","results","mergedResult","result","roads","codesMap","parseRoad","road","roadValueEntries","roadValue","has","CarriersField","CountriesField","postSovietKey","postSovietSubscription","RoadsField","countriesKey","countriesSubscription","StationsField","roadsKey","roadsSubscription","MainForm","fields","confirmButton","addClass","console","log","validationUrl","resolveFields","resolveFieldsSubscriptions","sectionElement","sectionKey","fieldKey","containsClass","className","resolveSelectField","resolveField","validateFields","fieldValues","forbidden"],"mappings":"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"}