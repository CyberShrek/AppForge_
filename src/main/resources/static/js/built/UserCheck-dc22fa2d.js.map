{"version":3,"file":"UserCheck-dc22fa2d.js","sources":["../../../../../../../typescript/util/domWizard.ts","../../../../../../../typescript/api/abstract/Accessor.ts","../../../../../../../typescript/api/abstract/JsonAccessor.ts","../../../../../../../typescript/store/appConfig.ts","../../../../../../../typescript/api/UserCheck.ts"],"sourcesContent":["// Used to create inner html and return them as elements\nconst factoryElement = document.createElement(\"factory\")\ndocument.body.appendChild(factoryElement)\nfactoryElement.hidden = true\n\nexport function create<T extends HTMLElement>(html: string): T{\n    factoryElement.innerHTML = html\n    return factoryElement.firstElementChild as T\n}\n\n// Removes all child elements\nexport function emptyElement(element: Element, withText: boolean = true){\n    const text = element.textContent\n    while(element.firstElementChild !== null)\n        element.firstElementChild.remove()\n\n    if(!withText) element.textContent = text\n}\n\nconst setOfUniqueIds = new Set<string>()\n// Returns startName with serial number\nexport function generateUniqueId(startName: string = \"element\"){\n    let serialNumber = 0,\n        id: string\n\n    do {\n        id = startName + \"-\" + serialNumber\n        serialNumber++\n    }\n\n    while (setOfUniqueIds.has(id) || document.getElementById(id) !== null)\n    setOfUniqueIds.add(id)\n    return id\n}\n\nexport function scrollIntoElement(element: HTMLElement) {\n    element.scrollIntoView({behavior: \"smooth\", block: \"start\"})\n}\n\nexport function toggleFullscreen(element: HTMLElement){\n    if(!!getFullscreenElement())\n        document.exitFullscreen()\n    else\n        element.requestFullscreen()\n}\n\nexport function getFullscreenElement(): Element{\n    return document.querySelector(\":fullscreen\")\n}\n\n// Each enable of cursor loading adds 1 item into this array, each disabling removes also 1 item.\n// The only purpose is to prevent disabling when not all loaded\nlet cursorLoadersCount = 0\n\nexport function addCursorLoader() {\n    document.documentElement.style.cursor = 'wait'\n    cursorLoadersCount++\n}\n\nexport function removeCursorLoader() {\n    cursorLoadersCount--\n    if(cursorLoadersCount <= 0)\n        document.documentElement.style.cursor = 'default'\n}","import wretch from \"wretch\"\nimport {jsonify, jsonToMap, mapToJson} from \"../../util/data\"\nimport {removeCursorLoader, addCursorLoader} from \"../../util/domWizard\"\nimport {popupHttpDataError} from \"../../util/modal\"\n\n\nexport abstract class Accessor<RESOURCE> {\n\n    abstract path: string\n    method: \"GET\" | \"POST\" = \"GET\"\n    params: Map<string, string> | {[param: string] : string}\n    headers: Map<string, string> | {[header: string] : string}\n    body: any\n    errorFooter: string = \"Ошибка получения ресурса\"\n\n\n    fetch(body?: any): Promise<RESOURCE> {\n        addCursorLoader()\n        if(body) this.body = body\n        return this.request\n            .catch((error: Error) => popupHttpDataError(error, this.errorFooter))\n            .finally(() => removeCursorLoader())\n            .then(entity => {\n                if (entity) return entity as RESOURCE\n            })\n    }\n\n    protected get requestInit(){\n        const requestInit = wretch(this.path + (this.params ? \"?\" + Object.entries(jsonify(this.params)).map(entry => entry[0]+\"=\"+entry[1]).join(\"&\") : \"\"))\n            .headers({\n                \"Content-Type\": \"application/json;charset=UTF-8\",\n                ...jsonify(this.headers)\n            })\n            .body(this.body ? JSON.stringify(this.body) : undefined)\n\n        return (this.method === \"GET\" ? requestInit.get() : requestInit.post())\n    }\n\n    protected abstract get request(): Promise<RESOURCE>\n}","import {Accessor} from \"./Accessor\"\n\nexport abstract class JsonAccessor<RESOURCE = any> extends Accessor<RESOURCE>{\n\n     override get request(): Promise<RESOURCE> {\n        return this.requestInit.text().then(text => {if(text) return JSON.parse(text)})\n    }\n}","// @ts-ignore config variable is placed in the html file\nexport let appConfig: AppConfig = window.config ? config : {}\n\nexport function setAppConfig(config: AppConfig){\n    appConfig = config\n}","import {JsonAccessor} from \"./abstract/JsonAccessor\"\nimport {appConfig} from \"../store/appConfig\"\n\nexport class UserCheck extends JsonAccessor<UserInfo>{\n    path = \"/appforge/ucheck\"\n    override errorFooter = \"Не удалось пройти проверку\"\n\n    constructor() {\n        super()\n        this.params = {code: appConfig.code}\n    }\n}"],"names":["factoryElement","document","createElement","create","html","innerHTML","firstElementChild","emptyElement","element","withText","text","textContent","remove","scrollIntoElement","scrollIntoView","behavior","block","toggleFullscreen","getFullscreenElement","exitFullscreen","requestFullscreen","querySelector","body","appendChild","hidden","cursorLoadersCount","Accessor","constructor","this","method","errorFooter","fetch","documentElement","style","cursor","request","catch","error","popupHttpDataError","finally","then","entity","requestInit","wretch","path","params","Object","entries","jsonify","map","entry","join","headers","assign","JSON","stringify","undefined","get","post","JsonAccessor","parse","appConfig","window","config","setAppConfig","UserCheck","super","code"],"mappings":"wFACA,MAAMA,EAAiBC,SAASC,cAAc,WAIxC,SAAUC,EAA8BC,GAE1C,OADAJ,EAAeK,UAAYD,EACpBJ,EAAeM,iBAC1B,UAGgBC,EAAaC,EAAkBC,GAAoB,GAC/D,MAAMC,EAAOF,EAAQG,YACrB,KAAoC,OAA9BH,EAAQF,mBACVE,EAAQF,kBAAkBM,SAE1BH,IAAUD,EAAQG,YAAcD,EACxC,CAkBM,SAAUG,EAAkBL,GAC9BA,EAAQM,eAAe,CAACC,SAAU,SAAUC,MAAO,SACvD,CAEM,SAAUC,EAAiBT,GACxBU,IACDjB,SAASkB,iBAETX,EAAQY,mBAChB,UAEgBF,IACZ,OAAOjB,SAASoB,cAAc,cAClC,CA9CApB,SAASqB,KAAKC,YAAYvB,GAC1BA,EAAewB,QAAS,EAiDxB,IAAIC,EAAqB,QC9CHC,EAAtB,WAAAC,GAGIC,KAAMC,OAAmB,MAIzBD,KAAWE,YAAW,0BA0BzB,CAvBG,KAAAC,CAAMT,GAGF,ODoCJrB,SAAS+B,gBAAgBC,MAAMC,OAAS,OACxCT,ICtCOH,IAAMM,KAAKN,KAAOA,GACdM,KAAKO,QACPC,OAAOC,GAAiBC,EAAmBD,EAAOT,KAAKE,eACvDS,SAAQ,KDuCjBd,SACGA,GAAsB,IACrBxB,SAAS+B,gBAAgBC,MAAMC,OAAS,eCxCnCM,MAAKC,IACF,GAAIA,EAAQ,OAAOA,CAAkB,GAEhD,CAED,eAAcC,GACV,MAAMA,EAAcC,EAAOf,KAAKgB,MAAQhB,KAAKiB,OAAS,IAAMC,OAAOC,QAAQC,EAAQpB,KAAKiB,SAASI,KAAIC,GAASA,EAAM,GAAG,IAAIA,EAAM,KAAIC,KAAK,KAAO,KAC5IC,QAAON,OAAAO,OAAA,CACJ,eAAgB,kCACbL,EAAQpB,KAAKwB,WAEnB9B,KAAKM,KAAKN,KAAOgC,KAAKC,UAAU3B,KAAKN,WAAQkC,GAElD,MAAwB,QAAhB5B,KAAKC,OAAmBa,EAAYe,MAAQf,EAAYgB,MACnE,EClCC,MAAgBC,UAAqCjC,EAEtD,WAAaS,GACV,OAAOP,KAAKc,YAAYhC,OAAO8B,MAAK9B,IAAS,GAAGA,EAAM,OAAO4C,KAAKM,MAAMlD,EAAK,GAChF,ECLE,IAAImD,EAAuBC,OAAOC,OAASA,OAAS,CAAE,EAEvD,SAAUC,EAAaD,GACzBF,EAAYE,CAChB,CCFM,MAAOE,UAAkBN,EAI3B,WAAAhC,GACIuC,QAJJtC,KAAIgB,KAAG,mBACEhB,KAAWE,YAAG,6BAInBF,KAAKiB,OAAS,CAACsB,KAAMN,EAAUM,KAClC"}